---
title: "Test of Pulling Data from Google Sheets and REDCap"
format: html
---

## Setup and then Google Sheets (deauth, as this is public)

Note that the BIOFIRE_API_KEY was added to GitHub secrets and is available as an environment variable in the .Renviron workflow as specified in workflow.yml.

```{r setup}
library(tidyverse)
library(googlesheets4)
library(REDCapTidieR)
```

Test with googlesheets first

```{r}
gs4_deauth()
gs <- read_sheet("https://docs.google.com/spreadsheets/d/1rSObbWjQtgty3zBx_W9EJgIw0WJbzAU-sFQXhkWWNsc/edit?resourcekey#gid=19405873482")
head(gs)
```


## Now trying data from REDCap, which uses an API key in the local .Renviron file


Define the URL

```{r}
redcap_uri <- "https://redcapproduction.umms.med.umich.edu/redcap_v14.0.15/API/"
REDCAP_API_KEY = cat('key.txt')
```

Now get the data, and display first 6 rows.

```{r}
data <- read_redcap(redcap_uri, REDCAP_API_KEY)
head(data)
```

## Remaining Issues

Still would like to do this with Encrypted Secrets in Github Actions,
https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions
so that I can schedule this to pull data and render reports weekly to a webpage with cron.

## Timestamp    
This website was updated at `r Sys.time()`